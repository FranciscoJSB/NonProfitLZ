{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "FSI Landing Zones on Microsoft Azure",
            "isWizard": false,
            "steps": [
                {
                    "name": "basics",
                    "label": "Deployment location",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope"
                        }
                    ]
                },
                {
                    "name": "lzSettings",
                    "label": "Management Group and Subscription Organization",
                    "subLabel": {
                        "preValidation": "Provide a prefix for the management group structure that will be created.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Company prefix",
                    "elements": [
                        {
                            "name": "info",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "FSI Landing Zones requires access at the tenant root (/) scope. Visit this link to ensure you have the appropriate RBAC permission to complete the deployment",
                                "uri": "https://docs.microsoft.com/azure/role-based-access-control/elevate-access-global-admin",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "mgSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Management Groups",
                            "elements": [
                                {
                                    "name": "mgmtGroup",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "FSI Landing Zones will create the management group hierarchy under the Tenant Root Group with the prefix provided at this step, which will be used to establish a proven architecture for subscription organization and policy driven governance at scale.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://github.com/microsoft/industry/tree/main/fsi#fsi-landing-zones-on-microsoft-azure"
                                        }
                                    }
                                },
                                {
                                    "name": "esMgmtGroup",
                                    "type": "Microsoft.Common.TextBox",
                                    "label": "Management Group prefix",
                                    "toolTip": "Provide a prefix (max 10 characters, unique at tenant-scope) for the Management Group hierarchy and other resources created as part of FSI Landing Zones.",
                                    "defaultValue": "",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9A-Z-]{1,10}$",
                                        "validationMessage": "The prefix must be 1-10 characters."
                                    }
                                }
                            ],
                            "visible": true
                        },
                        {
                            "name": "rpRegistrationApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "POST",
                                "path": "[concat('/providers/Microsoft.Management/managementGroups/',steps('basics').resourceScope.tenant.tenantId, '/providers/Microsoft.PolicyInsights/register?api-version=2021-04-01')]"
                            }
                        },
                        {
                            "name": "subSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Subscription Organization",
                            "elements": [
                                {
                                    "name": "subOrg",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "FSI Landing Zones recommends dedicated subscriptions for the Azure platform functionality, such as Security, Governance, Compliance, Network Connectivity, and Identity and Access. This enables the organization to scale the Azure platform and the workloads in the landing zones independently regardless of future scale-point.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://github.com/microsoft/industry/blob/main/fsi/docs/architectureAndDesign.md#architecture-and-design"
                                        }
                                    }
                                },
                                {
                                    "name": "subOrgsOption",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Select dedicated subscriptions or a single subscription for FSI Landing Zones platform resources",
                                    "defaultValue": "Dedicated (recommended)",
                                    "toolTip": "Dedicated subscriptions will require separate Azure subscriptions for platform resources and is the recommended option for production environments. The single subscription option will deploy all platform resources on a single subscription.",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Dedicated (recommended)",
                                                "value": "Dedicated"
                                            },
                                            {
                                                "label": "Single",
                                                "value": "Single"
                                            }
                                        ]
                                    },
                                    "visible": true
                                }
                            ],
                            "visible": true
                        },
                        {
                            "name": "esSingleSubSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Single platform subscription",
                            "elements": [
                                {
                                    "name": "subWarning",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "icon": "Warning",
                                        "text": "Dedicated subscriptions are recommended for the various platform components to ensure scale, sustainability, and segregation of duties, and especially around networking. However, a single subscription can also be used in case this is not a concern (e.g., small organizations, or testing purposes).",
                                        "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-group-and-subscription-organization"
                                    }
                                },
                                {
                                    "name": "singleSubText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the single subscription that will be used for all platform resources during deployment, for security, logging, connectivity, and identity."
                                    }
                                },
                                {
                                    "type": "Microsoft.Common.SubscriptionSelector",
                                    "name": "esSingleSub",
                                    "label": "Single platform subscription"
                                }
                            ],
                            "visible": "[equals(steps('lzSettings').subSection.subOrgsOption, 'Single')]"
                        }
                    ]
                },
                {
                    "name": "esConnectivityGoalState",
                    "label": "Network Connectivity and Topology",
                    "subLabel": {
                        "preValidation": "",
                        "postValidation": ""
                    },
                    "bladeTitle": "lzNetTopology",
                    "elements": [
                        {
                            "name": "multiPlatformConnectivitySub",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "To enable connectivity for Azure and on-premises, you must allocate a dedicated connectivity Subscription. Please note, this Subscription will be moved to the connectivity Management Group, and ARM will deploy the first hub virtual network for either a hub and spoke or Virtual WAN network topology. Additional networking platform resources such as gateways or Azure Firewall can be deployed. We recommend using a new dedicated Subscription with no existing resources. When you need to scale-out networking, either into the same region and same subscription, or to a new region or a separate connectivity subscription, use the following link to deploy and scale-out.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/define-an-azure-network-topology",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "singlePlatformConnectivitySub",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "To enable network topology and connectivity for Azure and on-premises, you can select the preferred networking topology, and deploy this into the dedicated platform subscription. Additional networking platform resources such as gateways or Azure Firewall can also be deployed.",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/define-an-azure-network-topology",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "connSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Azure Connectivity Configuration",
                            "elements": [
                                {
                                    "name": "azMonText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "The FSI Landing Zones provides the foundational networking and connectivity services for deploying telco applications and services on Microsoft Azure at scale. Select the preferred networking topology and services for Azure and the Distributed Edge.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://github.com/microsoft/industry/blob/main/telco/docs/telco-networking.md"
                                        }
                                    }
                                }
                            ],
                            "visible": true
                        },
                        {
                            "name": "esNwSubSection",
                            "type": "Microsoft.Common.Section",
                            "label": "Connectivity subscription",
                            "elements": [
                                {
                                    "type": "Microsoft.Common.SubscriptionSelector",
                                    "name": "esNwSub",
                                    "label": "Connectivity subscription"
                                }
                            ],
                            "visible": true
                        },
                        {
                            "name": "esAddressHubHS",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Address space (required for hub virtual network)",
                            "toolTip": "Provide address prefix in CIDR notation (e.g 10.100.0.0/16)",
                            "defaultValue": "10.100.0.0/16",
                            "visible": true
                        },
                        {
                            "name": "esVpnGateway",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy VPN Gateway",
                            "defaultValue": "No",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "esExpressRoute",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Deploy ExpressRoute Gateway",
                            "defaultValue": "No",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "esNsgFlowLogs",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable NSG Flow Logs and Traffic Analytics",
                            "defaultValue": "Yes (recommended)",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        },
                        {
                            "name": "esDdosProtection",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable DDoS Protection",
                            "defaultValue": "Yes, DDoS Network Protection (recommended)",
                            "toolTip": "If 'Yes' is selected when also adding a subscription for management, the solution will be deployed to the Log Analytics workspace.",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes, DDoS Network Protection (recommended)",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "Yes, DDoS Network Protection per individual public IP addresses",
                                        "value": "YesPerIP"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            },
                            "visible": true
                        }
                    ],
                    "visible": true
                }
            ]
        }
    },
    "outputs": {
        "parameters": {
            "selectedSubscription": "[steps('basics').resourceScope.subscription]"
        }
    }
}
